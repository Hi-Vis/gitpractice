---
title: "AURIN"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#https://aurin.org.au/resources/aurin-apis/aurin-open-api-and-r/
#https://github.com/asiripanich/aurin

install.packages("aurin")
library(aurin)

aur_register("research", "9g6P7DkT")
```
```{r}
aur_browse()

public_toilets<-aur_get("aurin:datasource-UQ_ERG-UoM_AURIN_DB_public_toilets")

state_polygons <- aur_get(open_api_id = "aurin:datasource-AU_Govt_ABS-UoM_AURIN_DB_GeoLevel_ste_2016_aust")
state_polygons <- state_polygons[state_polygons$state_code_2016 %in% 1:8, ]

```



```{r}
library(ggplot2)
ggplot(public_toilets) +
  geom_sf(data = state_polygons, fill = "antiquewhite") +
  geom_sf(alpha = 0.05, aes(color = status)) +
  labs(title = "Public toilets in Australia, 2017") +
  scale_color_brewer(palette = "Dark2") +
  theme_bw() +
  guides(colour = guide_legend(override.aes = list(alpha = 1))) +
  theme(panel.background = element_rect(fill = "aliceblue"))
```


```{r}
#RV zoom in on NSW specifically
library(tidyverse)
glimpse(state_polygons)

NSW_polygons<-state_polygons %>% filter(state_name_2016=="New South Wales")

glimpse(public_toilets)
NSW_toilets<-public_toilets %>% filter(state=="New South Wales")

NSW_toilets %>% count(isopen)
```



```{r}
NSW_plot<-ggplot(NSW_toilets) +
  geom_sf(data = NSW_polygons, fill = "antiquewhite") +
  geom_sf(alpha = 0.4, aes(color = status, shape=isopen, label=name)) +
  labs(title = "Public toilets in Australia, 2017") +
  scale_color_brewer(palette = "Dark2") +
  theme_bw() +
  guides(colour = guide_legend(override.aes = list(alpha = 1))) +
  theme(panel.background = element_rect(fill = "aliceblue"))
```

```{r}
#zoom further into Sydney North shore

Sydney_plot<-NSW_plot + 
    coord_sf(xlim = c(151.05, 151.3), ylim = c(-33.75, -33.87), expand = FALSE)

Sydney_plotly<-plotly::ggplotly(Sydney_plot)


```

```{r}
htmlwidgets::saveWidget(Sydney_plotly, "Sydney_plotly.html")
#share to my plotly account
# set plotly user name
Sys.setenv("plotly_username"="RachelPlotly")
# set plotly API key
Sys.setenv("plotly_api_key"="KkKdjsu9KGx5p8qyqBP7")
plotly::plotly_POST(Sydney_plotly, sharing="public")
```



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
